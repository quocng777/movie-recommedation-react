import{j as e,z as M,I as g,L as B,B as h,bg as U,r as a,D as W,E as Z,F as $,bh as q,G as Q,K,H as V}from"./index-CK2H4E3S.js";import{F as X,a as N,b as E,c as v,d as y,e as L,z as x,f as F,u as J,t as Y,h as ee,i as se}from"./get-error-response-data-BIa4GzR3.js";import{G as oe,C as te,u as ae}from"./use-redirect-to-hompage-Bo3UoDjT.js";import{D as re,b as ie,c as ne,d as le,e as ce,f as me}from"./dialog-B55C9sa1.js";import{L as de}from"./label-CUbgZq6n.js";import"./index-fZeKj1nN.js";const ue=c=>{const{form:o,onSubmit:n,isLoading:r,onGoogleAuthSuccess:m,onGoogleAuthError:i,onForgotPasswordClick:d}=c;return e.jsx(X,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(n),className:`relative max-w-[450px] w-full rounded-xl px-8 py-4 border-white border ${r?"pointer-events-none":""}`,children:[e.jsx("p",{className:"text-3xl font-semibold mb-4",children:"Welcome back!"}),e.jsx(M,{className:"absolute inset-1/2",isOpening:r}),e.jsxs("div",{className:`${r?"invisible":""}`,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Login with"}),e.jsx("div",{className:"w-full flex justify-center",children:e.jsx(oe,{clientId:"918389486849-ul5s89vem2furch9q0g7j5ei65so96ti.apps.googleusercontent.com",children:e.jsx(te,{onGoogleAuthSuccess:m,onGoogleAuthError:i})})})]}),e.jsxs("div",{className:"flex items-center my-4",children:[e.jsx("hr",{className:"flex-grow border-t border-white"}),e.jsx("p",{className:"px-4",children:"OR CONTINUE WITH"}),e.jsx("hr",{className:"flex-grow border-t border-white"})]}),e.jsx(N,{control:o.control,name:"email",render:({field:t})=>e.jsxs(E,{children:[e.jsx(v,{children:"Email"}),e.jsx(y,{children:e.jsx(g,{placeholder:"Enter your email",...t,type:"email"})}),e.jsx(L,{})]})}),e.jsx(N,{control:o.control,name:"password",render:({field:t})=>e.jsxs(E,{className:"mb-6",children:[e.jsx(v,{children:"Password"}),e.jsx(y,{children:e.jsx(g,{placeholder:"Enter your password",...t,type:"password"})}),e.jsx(L,{})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(B,{className:" text-blue-500 hover:underline",to:"/register",children:"Register an account?"}),e.jsx(h,{onClick:d,variant:"link",type:"submit",className:"p-0 m-0 text-blue-500",children:"Forgot your password?"})]}),e.jsx(h,{type:"submit",className:"mt-6 w-full",disabled:Object.keys(o.formState.errors).length>0,children:"Login"})]})]})})},xe=x.object({email:x.string().email(),password:x.string().min(F.PASSWORD_MIN_LENGTH).max(F.PASSWORD_MAX_LENGTH)}),be=()=>{const[c,{isLoading:o,isSuccess:n,isError:r,error:m,data:i}]=U(),[d,t]=a.useState(!1),[l,P]=a.useState(""),[k,p]=a.useState(""),{toast:j}=W(),[D,{isLoading:A,isSuccess:f,data:u}]=Z(),[G,{isSuccess:w,data:b}]=$(),[C,{isSuccess:S}]=q();ae();const R=Q(),I=s=>{D({token:s.access_token})},O=()=>{console.log("Login failed")},T=J({resolver:Y(xe),defaultValues:{password:"",email:""}}),_=async s=>{await c(s)},z=s=>{s.stopPropagation(),s.preventDefault(),t(!0)};a.useEffect(()=>{if(n||f){const s=(i==null?void 0:i.data)||(u==null?void 0:u.data);localStorage.setItem("access_token",s.accessToken),localStorage.setItem("refresh_token",s.refreshToken),G()}},[n,f]),a.useEffect(()=>{if(r){const s=ee(m);if(!s)return;j({variant:"destructive",title:"Uh oh! Something went wrong.",description:s.message,duration:2e3})}},[r]),a.useEffect(()=>{w&&R(K(b.data))},[w,b]),a.useEffect(()=>{S&&(t(!1),j({title:"Success",description:"âœ…âœ…âœ…Send email success, please check your emailðŸ’ŒðŸ’ŒðŸ’Œ"}))},[S]);const H=()=>{if(p(""),l.trim().length==0||!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(l)){p("Email is required");return}C({email:l})};return e.jsxs("div",{className:"flex w-full justify-center h-full min-h-screen items-center gap-10",children:[e.jsx(V,{children:e.jsx("title",{children:"Login"})}),e.jsxs("div",{className:"max-w-[480px] w-full flex justify-center flex-col items-center max-md:hidden",children:[e.jsx("h3",{className:" text-4xl font-semibold",children:"PopcornBox"}),e.jsx("img",{src:se})]}),e.jsx(ue,{form:T,onSubmit:_,isLoading:o||A,onGoogleAuthError:O,onGoogleAuthSuccess:I,onForgotPasswordClick:z}),e.jsx(re,{open:d,onOpenChange:t,children:e.jsxs(ie,{className:"sm:max-w-[425px]",children:[e.jsxs(ne,{children:[e.jsx(le,{children:"Forgot password"}),e.jsx(ce,{children:"Please enter your account email to receive a edit password mail from us."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(de,{htmlFor:"name",className:"text-right",children:"Email"}),e.jsx(g,{id:"name",value:l,className:"col-span-3",type:"email",onChange:s=>{P(s.target.value)}}),e.jsx("div",{className:"col-span-1"}),e.jsx("span",{className:"text-sm text-red-500 col-span-3",children:k})]})}),e.jsx(me,{children:e.jsx(h,{type:"submit",onClick:H,children:"Send email"})})]})})]})};export{be as default};
