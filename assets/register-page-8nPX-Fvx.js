import{j as e,z as I,I as c,L as R,B as v,A as U,D as P,E as C,F as H,G as D,r as N,J as S,K as k,H as O}from"./index-jqWcwVkE.js";import{F as X,a as m,b as d,c as u,d as h,e as x,z as n,f as i,g,u as B,h as z,i as W,t as q}from"./get-error-response-data-DBWjEeq7.js";import{G as $,C as J,u as K}from"./use-redirect-to-hompage-D9CsD9hT.js";import"./label-DE0-YdaS.js";import"./index-C2TBzLsc.js";const Q=t=>{const{form:o,onSubmit:j,isLoading:a,onGoogleAuthSuccess:f,onGoogleAuthError:l}=t;return e.jsx(X,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(j),className:`relative max-w-[450px] w-full rounded-xl px-8 py-4 border-white border ${a?"pointer-events-none":""}`,children:[e.jsx("p",{className:"text-3xl font-semibold mb-4",children:"Create an account"}),e.jsx(I,{className:"absolute inset-1/2",isOpening:a}),e.jsxs("div",{className:`${a?"invisible":""}`,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Register with"}),e.jsx("div",{className:"w-full flex justify-center",children:e.jsx($,{clientId:"918389486849-ul5s89vem2furch9q0g7j5ei65so96ti.apps.googleusercontent.com",children:e.jsx(J,{onGoogleAuthSuccess:f,onGoogleAuthError:l})})})]}),e.jsxs("div",{className:"flex items-center my-4",children:[e.jsx("hr",{className:"flex-grow border-t border-white"}),e.jsx("p",{className:"px-4",children:"OR CONTINUE WITH"}),e.jsx("hr",{className:"flex-grow border-t border-white"})]}),e.jsx(m,{control:o.control,name:"username",render:({field:s})=>e.jsxs(d,{children:[e.jsx(u,{children:"Username"}),e.jsx(h,{children:e.jsx(c,{placeholder:"Enter your username",...s})}),e.jsx(x,{})]})}),e.jsx(m,{control:o.control,name:"fullname",render:({field:s})=>e.jsxs(d,{children:[e.jsx(u,{children:"Fullname"}),e.jsx(h,{children:e.jsx(c,{placeholder:"Enter your fullname",...s})}),e.jsx(x,{})]})}),e.jsx(m,{control:o.control,name:"email",render:({field:s})=>e.jsxs(d,{children:[e.jsx(u,{children:"Email"}),e.jsx(h,{children:e.jsx(c,{placeholder:"Enter your email",...s,type:"email"})}),e.jsx(x,{})]})}),e.jsx(m,{control:o.control,name:"password",render:({field:s})=>e.jsxs(d,{children:[e.jsx(u,{children:"Password"}),e.jsx(h,{children:e.jsx(c,{placeholder:"Enter your password",...s,type:"password"})}),e.jsx(x,{})]})}),e.jsx(m,{control:o.control,name:"confirmPassword",render:({field:s})=>e.jsxs(d,{className:"mb-4",children:[e.jsx(u,{children:"Confirm your password"}),e.jsx(h,{children:e.jsx(c,{placeholder:"Enter your password again!",...s,type:"password"})}),e.jsx(x,{})]})}),e.jsx(R,{className:" text-blue-500 hover:underline mt-8",to:"/login",children:"Already have an account?"}),e.jsx(v,{type:"submit",className:"mt-6 w-full",disabled:Object.keys(o.formState.errors).length>0,children:"Create account"})]})]})})},V=n.object({username:n.string().min(i.USERNAME_MIN_LENGTH,g.USERNAME_MIN_LENGTH).max(i.USERNAME_MAX_LENGTH,g.USERNAME_MAX_LENGTH),fullname:n.string().max(i.FULLNAME_MAX_LENGTH,g.FULLNAME_MAX_LENGTH).min(i.USERNAME_MIN_LENGTH,g.FULLNAME_MIN_LENGTH),password:n.string().min(i.PASSWORD_MIN_LENGTH).max(i.PASSWORD_MAX_LENGTH),confirmPassword:n.string(),email:n.string().email()}).refine(t=>t.password===t.confirmPassword,{message:"Password and confirm password do not match each other",path:["confirmPassword"]}),oe=()=>{const[t,{isLoading:o,isSuccess:j,isError:a,error:f,data:l}]=U(),{toast:s}=P(),[b,{isLoading:y,isSuccess:w,data:p}]=C(),[M,{isSuccess:L,data:A}]=H(),_=D();K();const G=r=>{b({token:r.access_token})},T=()=>{console.log("Login failed")},E=B({resolver:q(V),defaultValues:{username:"",fullname:"",password:"",confirmPassword:"",email:""}}),F=async r=>{await t(r)};return N.useEffect(()=>{if(a){const r=z(f);if(console.log(r),!r)return;if(r.statusCode===S.EMAIL_DUPLICATED.customCode){E.setError("email",{type:"custom",message:"This email is used by others"});return}if(r.statusCode===S.USERNAME_DUPLICATED.customCode){E.setError("username",{type:"custom",message:"This username is used by others"});return}s({variant:"destructive",title:"Uh oh! Something went wrong.",description:"There was a problem with your request.",duration:2e3})}},[a]),N.useEffect(()=>{if(j||w){const r=(l==null?void 0:l.data)||(p==null?void 0:p.data);localStorage.setItem("access_token",r.accessToken),localStorage.setItem("refresh_token",r.refreshToken),M()}},[j,w]),N.useEffect(()=>{L&&_(k(A.data))},[L,A]),e.jsxs("div",{className:"flex w-full justify-center h-full min-h-screen items-center gap-10",children:[e.jsx(O,{children:e.jsx("title",{children:"Register"})}),e.jsxs("div",{className:"max-w-[480px] w-full flex justify-center flex-col items-center max-md:hidden",children:[e.jsx("h3",{className:" text-4xl font-semibold",children:"PopcornBox"}),e.jsx("img",{src:W})]}),e.jsx(Q,{form:E,onSubmit:F,isLoading:o||y,onGoogleAuthError:T,onGoogleAuthSuccess:G})]})};export{oe as default};
